using System;
using System.Security.Principal;
using WindowsFirewallHelper;

namespace SharpByeSentinel
{
    class Program
    {
        static void PrintBanner()
        {
            Console.WriteLine(@"
                                                                                
                  `````             `               ```                 ``````` 
```          `````````````````````````````      ```````````         ````````````
``` ``````` ```````````````  `````````` ````````````````       ``` ```` `````   
```````````` ```       ````` ++.   .#@@@@  ````````   ````` ``  ```   ``````````
``````` `````   ```````   :@@@@@@@@@@@@@@@@@@@@@@::::::,:,,::::   `````` .@@:   
 ```` ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,,:`````````.::@@@@##@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#';,,@@@@@@@@@@@@@@@:::`````````.: @@@@@@@@@@@@@@@@
@@@@@@@@@@@@                      @@@@@@@@@@@@@@@:::`` ``````,:`@@@@@@@@@@@@@@@@
@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@,::```` ````:: @@@@@@@@@@@@@@@@
@@@@@@ #@@@@ @@@@@@@@#@@@@@@@@@   @@@@@@@@@@@@@@@:::`````` ``,, @@@@@@@@@@@@@@@@
@@@@@   @@@@ @@@@@`  @@@@@@@ :;;  @@@@@@@@@@@@@@@:::`````````:, @@@@@@@@@@ @@@@@
@@@@     @@@ @@@`   +@@@ @@ ;;;:.  ;,#@@@@@@@@@@@:::````` `` :: @@@@@@@@@@  ;@@@
@@@      @@@ @@`    @@@@  @@:    :;;:#@@@@@@@@@@@:,:,,,,,,.`:::+@@@@@@@@@@+  #@@
@@      `@@@ @      @@@    ;;;;;;;;`.::: @@@@@@@@`:::::::::::: @@@@@@@@@@@@   @@
@@       @@@    '   @@:     ;;;:. ::;;;; ,`+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   @@
 +   '   @@@   '';   @  ;'  @ ::;.`::;.@@    @@@@@@@@@@@@@@@@@@@,@@@@@@@@@    # 
     '   @,@   '''      '''   :.@++@ : @    .@@@@@@@@@@@@@@@@@  @@@@@@@@@       
     '  @@ ., '''''    ''     ;@,   @ .#@    `      .@@@@@@@:  `@@@@@@@@   ;    
    `'  @@  `'''''''; ''      ;@    @`;:.;;;;:       @@@@@@  `  @@@@@@@   ''    
'    '  @@   ;'''''''''       :.@@@# ::;:;;;;::     @@@@@#  ',  .@@@@@`  `''.  '
''  ''  @'    '''''''';      ;;;;;;;;;:.``;::::;;..@'@@@   ' ......` @   ;''' ''
'''''  .@     '''''''.,,   `::;;;;;:;:;;;: @@++#@@@  @@   '' ':   .' ++  '''''''
'''''   @     '''''';.,, , :;;::;::;;;;;;; @@@@@@@   @ ` '''`'++++++ ''@@@@@@@@@
'''''   `     ''''''',,, , ::: : :;;;;;;::, @@@@@+      ''@@ '++++++ ,@@@@@@@@@@
''''',     '  ''''';;.,, , :::.: :;;;;;;;::,@@@@@,  ;  :@@@@ ;++++'+ @@@@@@@@@@@
''''''     '  ;;;;;;' ,, ,,,::;.:`;;;:;;;:.;'@@@@;  '' ''@@@@@@@@@@@@@@@@@@@@@@@
'''''';   ''  ;;;;;;; ,,,,. ,:::`:,     ,`;` `@@@#  ;''''''''''+''''''''''''''''
'''''''. '''  ::::,,'; ,,,,,, `:::::` :: ,,`;:@'@#  .'''''''''''''''''''''''''''
'''' ''';'';  ;;;;''';;; ,,,,,,,,,,,, :;;`  :;:: +  `''''''''+''+''  '''''''''' 
'''':'''''';  ;;;;  '';;'   ````      :;::` `  @@   ''''''''    ``   ````````   
'''';'''''''  ,;;   ;;;;;;;`,,.....   ``       `    '''  '''         ```````    
''''''''''''   ;     ;';;;;.,,.;;''   ,,;.   ;;;  '': ; ''''         ``````    ;
'':''.'''''''     ,  ';' '';,,.;;;;   ,,;,   ;;';;;;;' `.;'`        `````     .'
''.'' ''`' '''    '   '  ;;;,,.;;;'   ,,;;   ;;;;;;;;;;;;   ` .'    ````      ''
''''':'';''''''   ''     ;;;,,.;;;;   ,,;;   ;;;;;;;';;`     '''    ``       '''
'''''',''`':''''; '''`   ;;;` ;;;;;'; ,,;;  ';;;;;;;;:     :''''           ;''''
''''''''''''''''''''''' ``;'';;;;;;;;';;;;;;;;;;;;;;'   ` ;''''';        '''''''
''''''''''''''''''''''', ;;;;;;;;;;;';;;;;;;;;;;;;;'      '''''''',    '''''''''

");
        }

        public static bool IsHighIntegrity()
        {
            // returns true if the current process is running with adminstrative privs in a high integrity context
            WindowsIdentity identity = WindowsIdentity.GetCurrent();
            WindowsPrincipal principal = new WindowsPrincipal(identity);
            return principal.IsInRole(WindowsBuiltInRole.Administrator);
        }


        static void Main(string[] args)
        {

            PrintBanner();
            if (args.Length == 0)
            {
                Console.WriteLine("usage: SharpByeSentinel <programToDeny>");
                return;
            }
            string programToBlock = args[0];
            if (IsHighIntegrity())
            {

                var rule = FirewallManager.Instance.CreateApplicationRule(
                @"CYA NERDS",
                FirewallAction.Block,
                programToBlock
                );
                rule.Direction = FirewallDirection.Outbound;
                FirewallManager.Instance.Rules.Add(rule);
                Console.WriteLine("added {0} to the block list", programToBlock);
            }
            else
            {
                Console.WriteLine("You need Local Admin Bruh");
            }
        }
    }
}
